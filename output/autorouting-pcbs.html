<!doctype html>
<html class="no-js" lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<title>Autorouting PCBs - Ian Kilgore's blog
</title>
		<meta name="description" content="">
		<meta name="author" content="Ian Kilgore">

		<link rel="stylesheet" href="http://blog.iank.org/theme/css/foundation.css" />
                <link rel="alternate" href="http://blog.iank.org/feeds/all.rss.xml" type="application/rss+xml" title="blog.iank.org RSS feed" />

		<link rel="stylesheet" href="http://blog.iank.org/theme/css/pygment/monokai.css" />
		<link rel="stylesheet" href="http://blog.iank.org/theme/css/custom.css" />


		<script src="http://blog.iank.org/theme/js/modernizr.js"></script>

		<!-- Feeds -->
		<link href="http://blog.iank.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Ian Kilgore's blog Atom Feed" />


		<!-- mathjax config similar to math.stackexchange -->
		<script type="text/x-mathjax-config">
		MathJax.Hub.Config({
			jax: ["input/TeX", "output/HTML-CSS"],
			tex2jax: {
				inlineMath: [ ['$', '$'] ],
				displayMath: [ ['$$', '$$']],
				processEscapes: true,
				skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
			},
			messageStyle: "none",
			"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
		});
		</script>
		<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
	</head>
	<body>
		<div class="off-canvas-wrap">
			<div class="inner-wrap">
				<!-- mobile top bar to activate nav -->
				<nav class="tab-bar show-for-small">
					<section class="left-small">
						<a class="left-off-canvas-toggle menu-icon" ><span></span></a>
					</section>

					<section class="middle tab-bar-section">
						<h1 class="title">Ian&nbsp;Kilgore's&nbsp;blog</h1>
					</section>
				</nav>

				<!-- mobile side bar nav -->
				<aside class="left-off-canvas-menu">
					<ul class="off-canvas-list">
						<li><a href="http://blog.iank.org">Home</a></li>
						<li><label>Categories</label></li>
							<li ><a href="http://blog.iank.org/category/computer-vision.html">computer vision</a></li>
							<li ><a href="http://blog.iank.org/category/machine-learning.html">machine learning</a></li>
							<li ><a href="http://blog.iank.org/category/math.html">math</a></li>
							<li class="active"><a href="http://blog.iank.org/category/misc.html">misc</a></li>

						<li><label>Places</label></li>
							<li><a href="http://blog.iank.org/">Blog</a></li>
							<li><a href="http://blog.iank.org/pages/contact.html">Contact</a></li>
							<li><a href="http://iank.org/">Home</a></li>
							<li><a href="http://iank.org/projects.html">Projects</a></li>



<!--						<li><label>Links</label></li>
 -->
					</ul>	
				</aside>

				<!-- top bar nav -->
				<nav class="top-bar hide-for-small-only" data-topbar>
					<ul class="title-area">
						<li class="name">
							<h1><a href="http://blog.iank.org/">Ian Kilgore's blog</a></h1>
						</li>
					</ul>

					<section class="top-bar-section">
						<ul class="left">
								<li ><a href="http://blog.iank.org/category/computer-vision.html">computer vision</a></li>
								<li ><a href="http://blog.iank.org/category/machine-learning.html">machine learning</a></li>
								<li ><a href="http://blog.iank.org/category/math.html">math</a></li>
								<li class="active"><a href="http://blog.iank.org/category/misc.html">misc</a></li>
						</ul>
					</section>
				</nav>

				<!-- Main Page Content and Sidebar -->
				<section class="main-section">
					<div class="row">
						<!-- Main Content -->
						<div class="medium-9 small-12 columns" role="content">
<article>
	<h2>Autorouting PCBs</h2>
	<h3>Problem</h3>
<p><a href="http://en.wikipedia.org/wiki/Routing_(electronic_design_automation)">Routing</a>, in electronic design, is a difficult and often intractible problem. Usually it is done with at least some human intervention. Most Electronic Design Automation packages include sophisticated software tools to allow the routing process to be machine-assisted or, in some cases, entirely automatic. Below I investigate some of the simplest methods for solving this problem, and demonstrate a working (albeit trivial) example of an automated approach.</p>
<p>The problem of routing deals with 'nets', which are lists of pins or pads which must be connected by some conductor. Also, different nets should not be electrically connected. This class of error is called a 'short'. Shorts with other nets can be avoided when routing a net by:</p>
<ul>
<li>Simply routing around any existing routes which are in the way (as in Tron)</li>
<li>Using multiple layers to allow routes to avoid each other 'vertically'. This requires placing <a href="http://en.wikipedia.org/wiki/Via_(electronics)">vias</a>, which introduces additional cost.</li>
<li>As a last resort, a jumper wire can be introduced in order to complete a route.</li>
</ul>
<p>Other design rules must be obeyed. In the case of printed circuit boards, fabrication processes have minimum trace widths, spacing tolerances, and so on. Wire length must be minimized and, depending on the domain, there are other electrical constraints to be considered.</p>
<h3>Method</h3>
<p>Several simple algorithms are described in [<sup id="fnref:zhou"><a class="footnote-ref" href="#fn:zhou" rel="footnote">1</a></sup>] below. The Lee Algorithm is straightforward, and can be used to route nets with multiple nodes. Routing can also take place on a weighted grid. Instead of minimizing wire length (as if all weights were unity), we then attempt to find paths with minimum cost. In future problems I assign weights in order to discourage (but still allow, as a first pass) errors such as shorts or design rule violations. In the demonstration below, however, all weights are either unity or infinity (blocked cells, e.g. pads and already-routed tracks).</p>
<p>This approach finds many possible paths from some source[s] to a destination node by wave propagation, then picks the lowest-cost path by tracing backwards. It may be useful to skip to the <a href="#vis">visualization</a> below before proceeding.</p>
<h4>Routing a single net</h4>
<p>Setting aside for a moment the problem of choosing the order in which nets should be routed, we consider the problem of finding the best (or lowest-cost) route to a grid cell $T$ from one or many cells $\vec{S}$ (In the case of a three-node net in which two nodes have already been routed, we may connect the remaining node to any point in $\vec{S}$).</p>
<p>This approach finds many possible paths to $T$ from $\vec{S}$ by propagating a wave from $\vec{S}$. We begin by considering the neighbors of $\vec{S}$, and marking them with the cost to reach each cell.</p>
<p>For each $S_i$ in $\vec{S}$:</p>
<ul>
<li>Update cost to reach each neighbor, $N_j$ of $S_i$: $cost(N_j) = cost(S_i) + weight(N_j)$</li>
<li>(Some $N_j$ may already be marked. If so, only update if the new cost is less than the current)</li>
<li>Stop once we reach $T$. In the case of a weighted grid, we should proceed until the route surronds $T$, in case a lower-cost path can be realized by approaching from a different direction.</li>
</ul>
<p>An example of a propagated wave from $S$ to $T$ (labelled) is shown below. The deep red inclusions in the wave are cells with infinite weight (obstacles or pads belonging to different nets).</p>
<p><a href="/images/waveprop.png"><img alt="Wave from S to T showing many possible paths" src="/images/waveprop_t.png" /></a></p>
<p>Now that each cell has been marked with a cost, the total cost for each discovered path can be computed by the sum of the cost for each cell along the way. The lowest-cost path can be discovered more simply, by backtracing a path from $T$ to any $S$. (Simply follow the lowest-cost neighboring cell until an $S$ is reached).</p>
<h4>Routing order</h4>
<p>One way to decide the order in which to route nets is to "order the nets in the ascending order of the [number] of pins within their bounding boxes<sup id="fnref:zhou"><a class="footnote-ref" href="#fn:zhou" rel="footnote">1</a></sup>." This seeks to avoid enclosing or intersecting other would-be routes by routing the least extensive nets first. In the example below, this approach is successful.</p>
<p>In practice, this may not lead to the best order. Other approaches require many passes: route order is chosen in some random fashion and nets are heuristically routed and 'ripped up' until all nets are routed, all possibilities are exhausted, or some time limit is exceeded.</p>
<h3>Demo</h3>
<p>I constructed an approximate grid based on the PCB for this <a href="http://www.learningelectronics.net/circuits/fridge-door-open-alarm-circuit-project.html">fridge "door open" alarm</a> project. The first figure below is the PCB from that project (I did not create it). The second figure is like a topological approximation. I have not preserved the scale. The node colours represent net membership, i.e. all of the light red nodes must be connected to each other through the routing process. The rightmost figure shows the final routed PCB.</p>
<p><a href="/images/orig.jpg"><img alt="Original PCB layout" src="/images/orig_t.jpg" title="Original PCB layout" /></a>
<a href="/images/unrouted.png"><img alt="My approximated model - unrouted" src="/images/unrouted_t.png" title="My approximated model - unrouted" /></a>
<a href="/images/routed.png"><img alt="Routed" src="/images/routed_t.png" title="Routed" /></a></p>
<p>Below is an animation of this grid being routed by the method described above:</p>
<ul>
<li>The routing order is determined by the number of pins w/in a net's bounding box (not shown)</li>
<li>For each net (in order), until it is fully routed or unroutable:<ul>
<li>Pick a source grid cell, $S$, at random (or, if partially routed, use the entire routed portion as a source)</li>
<li>Pick the closest destination, $T$. This is the single blue cell shown in the upper subplot</li>
<li>Propagate wave from $S$ to $T$ across the weighted grid (Top Subplot)</li>
<li>Backtrace a lowest-cost path (Bottom Subplot)</li>
</ul>
</li>
</ul>
<p><a id="vis"><iframe id="ytplayer" type="text/html" width="640" height="390" src="http://www.youtube.com/embed/2kUMe5PkyCg?autoplay=0&origin=http://blog.iank.org" frameborder="0" allowfullscreen></iframe></a></p>
<h3>Code</h3>
<p>MATLAB code for this demo may be found on github: <a href="https://github.com/iank/route1">iank/route1</a>.</p>
<h3>References</h3>
<div class="footnote">
<hr />
<ol>
<li id="fn:zhou">
<p>H. Zhou. <em>Northwestern University EECS357, Introduction to VLSI CAD. Lecture 6 [PDF Document]</em>. Retrieved from: <a href="http://users.eecs.northwestern.edu/~haizhou/357/lec6.pdf">http://users.eecs.northwestern.edu/~haizhou/357/lec6.pdf</a>&#160;<a class="footnote-backref" href="#fnref:zhou" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
	<hr/>
	<h6>Written by <a href="http://blog.iank.org/author/ian-kilgore.html">Ian Kilgore</a> in <a href="http://blog.iank.org/category/misc.html">misc</a> on Sun 11 August 2013. Tags: <a href="http://blog.iank.org/tag/computer-math.html">computer math</a>, <a href="http://blog.iank.org/tag/eda.html">EDA</a>, <a href="http://blog.iank.org/tag/routing.html">routing</a>, </h6>
</article>

<hr/>
						</div>
						<!-- End Main Content -->
						<!-- Sidebar -->
						<aside class="medium-3 hide-for-small-only columns">
							<div class="panel">
								<h5>Places</h5>
								<ul class="side-nav">
									<li><a href="http://blog.iank.org/">Blog</a></li>
									<li><a href="http://blog.iank.org/pages/contact.html">Contact</a></li>
									<li><a href="http://iank.org/">Home</a></li>
									<li><a href="http://iank.org/projects.html">Projects</a></li>
								</ul>
							</div>

							<div class="panel">
								<h5>Tags</h5>
								<ul class="tag-cloud">
								</ul>
							</div>


<!--							<div class="panel">
								<h5>Links</h5>
								<ul class="side-nav">
								</ul> 
							</div> -->
						</aside>
						<!-- End Sidebar -->
					</div>

					<!-- Footer -->
					<footer class="row">
						<div class="medium-9 small-12">
							<hr/>
							<p class="text-center">Powered by <a href="http://getpelican.com">Pelican</a> and <a href="http://foundation.zurb.com/">Zurb Foundation</a>. Theme by <a href="http://hamaluik.com">Kenton Hamaluik</a>.</p>
						</div>
					</footer>
					<!-- End Footer -->
				</section>
				<a class="exit-off-canvas"></a>
			</div><!--off-canvas inner-->
		</div><!--off-canvas wrap-->

		<script src="http://blog.iank.org/theme/js/jquery.js"></script>
		<script src="http://blog.iank.org/theme/js/foundation.min.js"></script>
		<script>
			$(document).foundation();
		</script>
	</body>
</html>