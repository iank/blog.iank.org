<!doctype html>
<html class="no-js" lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<title>Reconstructing phase space and estimating maximal Lyapunov exponent from experimental time series - Ian Kilgore's blog
</title>
		<meta name="description" content="">
		<meta name="author" content="Ian Kilgore">

		<link rel="stylesheet" href="http://blog.iank.org/theme/css/foundation.css" />
                <link rel="alternate" href="http://blog.iank.org/feeds/all.rss.xml" type="application/rss+xml" title="blog.iank.org RSS feed" />

		<link rel="stylesheet" href="http://blog.iank.org/theme/css/pygment/monokai.css" />
		<link rel="stylesheet" href="http://blog.iank.org/theme/css/custom.css" />


		<script src="http://blog.iank.org/theme/js/modernizr.js"></script>

		<!-- Feeds -->
		<link href="http://blog.iank.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Ian Kilgore's blog Atom Feed" />


		<!-- mathjax config similar to math.stackexchange -->
		<script type="text/x-mathjax-config">
		MathJax.Hub.Config({
			jax: ["input/TeX", "output/HTML-CSS"],
			tex2jax: {
				inlineMath: [ ['$', '$'] ],
				displayMath: [ ['$$', '$$']],
				processEscapes: true,
				skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
			},
			messageStyle: "none",
			"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
		});
		</script>
		<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
	</head>
	<body>
		<div class="off-canvas-wrap">
			<div class="inner-wrap">
				<!-- mobile top bar to activate nav -->
				<nav class="tab-bar show-for-small">
					<section class="left-small">
						<a class="left-off-canvas-toggle menu-icon" ><span></span></a>
					</section>

					<section class="middle tab-bar-section">
						<h1 class="title">Ian&nbsp;Kilgore's&nbsp;blog</h1>
					</section>
				</nav>

				<!-- mobile side bar nav -->
				<aside class="left-off-canvas-menu">
					<ul class="off-canvas-list">
						<li><a href="http://blog.iank.org">Home</a></li>
						<li><label>Categories</label></li>
							<li ><a href="http://blog.iank.org/category/computer-vision.html">computer vision</a></li>
							<li ><a href="http://blog.iank.org/category/machine-learning.html">machine learning</a></li>
							<li class="active"><a href="http://blog.iank.org/category/math.html">math</a></li>
							<li ><a href="http://blog.iank.org/category/misc.html">misc</a></li>

						<li><label>Places</label></li>
							<li><a href="http://blog.iank.org/">Blog</a></li>
							<li><a href="http://blog.iank.org/pages/contact.html">Contact</a></li>
							<li><a href="http://iank.org/">Home</a></li>
							<li><a href="http://iank.org/projects.html">Projects</a></li>



<!--						<li><label>Links</label></li>
 -->
					</ul>	
				</aside>

				<!-- top bar nav -->
				<nav class="top-bar hide-for-small-only" data-topbar>
					<ul class="title-area">
						<li class="name">
							<h1><a href="http://blog.iank.org/">Ian Kilgore's blog</a></h1>
						</li>
					</ul>

					<section class="top-bar-section">
						<ul class="left">
								<li ><a href="http://blog.iank.org/category/computer-vision.html">computer vision</a></li>
								<li ><a href="http://blog.iank.org/category/machine-learning.html">machine learning</a></li>
								<li class="active"><a href="http://blog.iank.org/category/math.html">math</a></li>
								<li ><a href="http://blog.iank.org/category/misc.html">misc</a></li>
						</ul>
					</section>
				</nav>

				<!-- Main Page Content and Sidebar -->
				<section class="main-section">
					<div class="row">
						<!-- Main Content -->
						<div class="medium-9 small-12 columns" role="content">
<article>
	<h2>Reconstructing phase space and estimating maximal Lyapunov exponent from experimental time series</h2>
	<h3>Background</h3>
<p>Last week I took some measurements of a system for my research and needed to show if the system was <a href="https://en.wikipedia.org/wiki/Chaos_theory">chaotic</a>. The measured data was a 1-dimensional time series from a <a href="http://www.polytec.com/us/products/vibration-sensors/single-point-vibrometers/complete-systems/pdv-100-portable-digital-vibrometer/">Laser Doppler Vibrometer (LDV)</a>. In order to show the system was chaotic I reconstructed state space using the method of delays, and estimated the maximal Lyapunov exponent of the system.</p>
<p>Continuous<sup id="fnref:discrete"><a class="footnote-ref" href="#fn:discrete" rel="footnote">1</a></sup> systems must be at least three-dimensional in order to exhibit chaos, but it's possible to reconstruct higher-dimensional state space from a 1-dimensional time series[<sup id="fnref:packard"><a class="footnote-ref" href="#fn:packard" rel="footnote">2</a></sup>] by lagging the data, e.g. taking $x(t)$ and turning it into a series of vectors $[ x(t), x(t+T), ..., x(t+nT) ]$. There are a variety of methods for determining the constant $T$, and the embedding dimension (sometimes called $m$), and there is no clear best method. Fortunately these systems are somewhat forgiving.</p>
<h3>Method of delays</h3>
<p>In my experiment I generated a time series based on the <a href="https://en.wikipedia.org/wiki/Lorenz_system">Lorenz system</a> by integrating the Lorenz equations with one of MATLAB's Runge-Kutta ODE solvers (code <a href="https://github.com/iank/lyapunov_estimation/blob/master/lorenz_ode.m">lorenz_ode.m</a> <a href="https://github.com/iank/lyapunov_estimation/blob/master/gen_chaos.m">gen_chaos.m</a>).</p>
<p>Plotting $x$, $y$, and $z$ over $t=[0,100]$ produces a nice Lorenz attractor</p>
<p><img alt="Lorenz attractor" src="/images/chaos/lorenz_attractor.png" /></p>
<p>I took the $z$ variable (<a href="https://raw.githubusercontent.com/iank/lyapunov_estimation/master/lorenz_z.txt">lorenz_z.txt</a>) and used the method of delays to reproduce the attractor. I just guessed at a lag value. I'll demonstrate a better method below.</p>
<p><img alt="Reproduced attractor" src="/images/chaos/lorenz_ts_reconstruction.png" /></p>
<p>We see that it is warped, but the underlying structure is there. For my experiment I generated a 100 Hz sinusoidal tone and added a scaled (1/50) and sped-up (100x) version of the Lorenz time series generated above. One second of data (at 204,800 samples/sec) was sent to a DAC, amplified, and used to drive a speaker coil. The vibration of the coil was measured using an LDV, producing a <a href="https://raw.githubusercontent.com/iank/lyapunov_estimation/master/lorenz_ldv.csv">time series</a>.</p>
<p><img alt="Time series LDV data" src="/images/chaos/lorenz_ldv.png" /></p>
<h3>Determining lag</h3>
<p>Andrew Fraser and Harry Swinney[<sup id="fnref:fraser"><a class="footnote-ref" href="#fn:fraser" rel="footnote">3</a></sup>] give a method for determining appropriate lag for the method of delays using mutual information<sup id="fnref:memory"><a class="footnote-ref" href="#fn:memory" rel="footnote">4</a></sup>. <a href="http://www.physics.emory.edu/faculty/weeks/">Dr. Eric Weeks</a> wrote a <a href="http://www.physics.emory.edu/faculty/weeks//software/minfo.html">C program</a> which implements their method, and you can <a href="http://www.physics.emory.edu/faculty/weeks//research/tseries3.html">read more about it on his website</a>.</p>
<p>Running this program on my LDV data produced <a href="https://raw.githubusercontent.com/iank/lyapunov_estimation/master/lorenz_ldv.mi.csv">this signal</a>, plotted below. From this we can see that the first minimum is around $T=770$ (discrete steps, or $770 / Fs = 3.76$ milliseconds).</p>
<p><img alt="I(T) for LDV data" src="/images/chaos/lorenz_ldv_mi.png" /></p>
<p>I reconstruct the attractor in MATLAB using this delay:</p>
<div class="codehilite"><pre><span></span><span class="nt">lz</span> <span class="o">=</span> <span class="nt">csvread</span><span class="o">(</span><span class="s1">&#39;lorenz_ldv.csv&#39;</span><span class="o">);</span>
<span class="nt">N</span> <span class="o">=</span> <span class="nt">length</span><span class="o">(</span><span class="nt">lz</span><span class="o">);</span>
<span class="nt">T</span> <span class="o">=</span> <span class="nt">770</span><span class="o">;</span>
<span class="nt">X</span> <span class="o">=</span> <span class="cp">[</span><span class="nx">lz</span><span class="p">((</span><span class="mi">1</span><span class="p">:</span><span class="nx">N</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="nx">T</span><span class="p">)),</span> <span class="nx">lz</span><span class="p">((</span><span class="mi">1</span><span class="p">:</span><span class="nx">N</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="o">+</span> <span class="nx">T</span><span class="p">),</span> <span class="nx">lz</span><span class="p">((</span><span class="mi">1</span><span class="p">:</span><span class="nx">N</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="nx">T</span><span class="p">)</span><span class="cp">]</span><span class="o">;</span>
<span class="nt">X</span> <span class="o">=</span> <span class="nt">X</span><span class="o">(</span><span class="nt">1</span><span class="nd">:100000</span><span class="o">,</span> <span class="o">:);</span>  <span class="o">%</span> <span class="nt">take</span> <span class="nt">first</span> <span class="o">~</span><span class="nt">half</span> <span class="nt">of</span> <span class="nt">data</span> <span class="nt">so</span> <span class="nt">the</span> <span class="nt">plot</span> <span class="nt">isn</span><span class="s1">&#39;t too dense</span>
<span class="s1">plot(X(:,1), X(:,2));</span>
<span class="s1">title(&#39;</span><span class="nt">Reconstructed</span> <span class="nt">attractor</span> <span class="nt">from</span> <span class="nt">LDV</span> <span class="nt">data</span><span class="s1">&#39;);</span>
<span class="s1">xlabel(&#39;</span><span class="nt">x</span><span class="o">(</span><span class="nt">t</span><span class="o">)</span><span class="s1">&#39;); ylabel(&#39;</span><span class="nt">x</span><span class="o">(</span><span class="nt">t</span><span class="o">+</span><span class="nt">770</span><span class="o">)</span><span class="err">&#39;</span><span class="o">);</span>
</pre></div>


<p><img alt="Reconstructed attractor from LDV data" src="/images/chaos/lorenz_ldv_attractor.png" /></p>
<p>This does not look like the Lorenz attractor because the system is dominated by the 100 Hz carrier. It may be possible to get a better-looking reconstruction by taking the envelope of the signal. Zooming, we see dense orbits<sup id="fnref:control"><a class="footnote-ref" href="#fn:control" rel="footnote">5</a></sup>:</p>
<p><img alt="Reconstructed attractor from LDV data" src="/images/chaos/lorenz_ldv_attractor_zoom.png" /></p>
<h3>Estimation of MLE</h3>
<p><a href="https://en.wikipedia.org/wiki/Lyapunov_exponent">Lyapunov exponents</a> describe how a system expands and contracts in phase space. There is a spectrum of exponents but the maximal Lyapunov exponent (MLE, often written $\lambda_1$) characterizes the system. One of the features of chaos is exponential divergence (sensitivity to initial conditions). Two trajectories, initially arbitrarily close to each other, will diverge exponentially in phase space. The existence of a positive Lyapunov exponent is good evidence for chaos. It is also an indication of the long-term predictibility of a system: it may be specified in <a href="https://en.wikipedia.org/wiki/Nat_(unit)">nats</a> per second (or bits or digits), giving the amount of time it takes for uncertainty in a system to increase by a factor of $e$ (or 2 or 10). Note that there must be <em>exponential</em> divergence for this analysis to be meaningful.</p>
<p>If differential equations for a system are known, it may be possible to solve for $\lambda_1$. Otherwise, it can be estimated by solving the system numerically, as in [<sup id="fnref:benettin"><a class="footnote-ref" href="#fn:benettin" rel="footnote">6</a></sup>]: Integrate the system for two nearby initial conditions and watch how the trajectories diverge. Renormalization is necessary as most systems are bounded (two points can only be so far away from each other in phase space).</p>
<p>In my case, I have a small amount of data (204800 samples), and only one trajectory in phase space. Rosenstein, et. al. <sup id="fnref:rosenstein"><a class="footnote-ref" href="#fn:rosenstein" rel="footnote">7</a></sup> present a method for estimating $\lambda_1$ in this case:</p>
<ul>
<li>Reconstruct the attractor using the method of delays (I use an embedding dimension of $m=10$)</li>
<li>For each point $j$:<ul>
<li>Find that point's nearest neighbor with the constraint that it must have at least one mean period of temporal separation. The temporal separation constraint allows us to treat our single trajectory as a collection of trajectories having separate evolutions.</li>
<li>Follow the evolution of both points, calculating the distance $d_j(i)$ between them with respect to time step $i$.</li>
</ul>
</li>
<li>Take the average over all points $j$: $d(i) = \mathrm{mean}(d_j(i))$</li>
<li>Plot $ln(d(i))$. A straight line here indicates exponential divergence (there will likely be two regions, an initial exponential divergence and then a flat portion. This happens when phase space is bounded and there is a maximum distance, as discussed above).</li>
<li>Fit a line to $ln(d(i))$.</li>
</ul>
<p>I've <a href="https://github.com/iank/lyapunov_estimation/blob/master/rosenstein.m">implemented this algorithm in MATLAB</a>.</p>
<div class="codehilite"><pre><span></span><span class="nt">di</span> <span class="o">=</span> <span class="nt">rosenstein</span><span class="o">(</span><span class="nt">lz</span><span class="o">,</span> <span class="nt">770</span><span class="o">);</span>
<span class="nt">Fs</span> <span class="o">=</span> <span class="nt">204800</span><span class="o">;</span>
<span class="nt">figure</span><span class="o">;</span>
<span class="nt">plot</span><span class="o">((</span><span class="nt">1</span><span class="nd">:length</span><span class="o">(</span><span class="nt">di</span><span class="o">))</span> <span class="o">/</span> <span class="nt">Fs</span><span class="o">,</span> <span class="nt">log</span><span class="o">(</span><span class="nt">di</span><span class="o">));</span>
<span class="nt">title</span><span class="o">(</span><span class="s1">&#39;Divergence for LDV data - Average distance between nearest neighbors&#39;</span><span class="o">);</span>
<span class="nt">xlabel</span><span class="o">(</span><span class="s1">&#39;Lag (s)&#39;</span><span class="o">);</span>
<span class="nt">ylabel</span><span class="o">(</span><span class="s1">&#39;ln(d_j(i))&#39;</span><span class="o">);</span>

<span class="o">%%</span> <span class="nt">Fit</span> <span class="nt">line</span>
<span class="nt">x1</span> <span class="o">=</span> <span class="nt">1</span><span class="o">;</span>
<span class="nt">x2</span> <span class="o">=</span> <span class="nt">6643</span><span class="o">;</span>
<span class="nt">p</span> <span class="o">=</span> <span class="nt">polyfit</span><span class="o">((</span><span class="nt">x1</span><span class="nd">:x2</span><span class="o">)</span><span class="s1">&#39;/Fs, log(di(x1:x2)),1);</span>
<span class="s1">h = refline(p);</span>
<span class="s1">set(h, &#39;</span><span class="nt">LineStyle</span><span class="s1">&#39;, &#39;</span><span class="o">:</span><span class="s1">&#39;);</span>
<span class="s1">text(0.04, 3.4, sprintf(&#39;</span><span class="nt">slope</span> <span class="o">=</span> <span class="o">%</span><span class="nc">.2f</span> <span class="nt">nats</span><span class="o">/</span><span class="nt">sec</span><span class="err">&#39;</span><span class="o">,</span> <span class="nt">p</span><span class="o">(</span><span class="nt">1</span><span class="o">)));</span>
</pre></div>


<p><img alt="Divergence of LDV data" src="/images/chaos/lorenz_ldv_divergence.png" /></p>
<h3>Sanity check</h3>
<p>Is this a reasonable value for our system? I used this method on the original, computed<sup id="fnref:computed"><a class="footnote-ref" href="#fn:computed" rel="footnote">8</a></sup> Lorenz data ($[x(t), y(t), z(t)]$) and the computed time series $[z(t), z(t+T), ..., z(t+9T)]$ .</p>
<p><img alt="Divergence of original attractor" src="/images/chaos/lorenz_orig_divergence.png" />
<img alt="Divergence of z(t) time series" src="/images/chaos/lorenz_z_divergence.png" /></p>
<p>Note that the $z(t)$ data has been sped up by a factor of 100, so the estimated values for $\lambda_1$ are about equal. The <a href="http://sprott.physics.wisc.edu/chaos/lorenzle.htm">actual MLE for the Lorenz system</a> is known to be about 0.9056. So there is a significant error<sup id="fnref:error"><a class="footnote-ref" href="#fn:error" rel="footnote">9</a></sup> but the values are within reason for my purpose, which is to broadly characterize a time series.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:discrete">
<p>It's possible to have e.g. 1-D discrete maps which are chaotic.&#160;<a class="footnote-backref" href="#fnref:discrete" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:packard">
<p>Packard, Norman H., et al. "Geometry from a time series." Physical review letters 45.9 (1980): 712.&#160;<a class="footnote-backref" href="#fnref:packard" rev="footnote" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:fraser">
<p>Fraser, Andrew M., and Harry L. Swinney. "Independent coordinates for strange attractors from mutual information." Physical review A 33.2 (1986): 1134.&#160;<a class="footnote-backref" href="#fnref:fraser" rev="footnote" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:memory">
<p>One of the things that differentiates chaos from random noise is that there is long-term memory, i.e. the autocorrelation function or this mutual information metric takes a long time to decay; autocorrelation for perfect Gaussian white noise is a sharp peak at zero lag, and zero everywhere else.&#160;<a class="footnote-backref" href="#fnref:memory" rev="footnote" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
<li id="fn:control">
<p>Compare to a non-chaotic signal, a perfect sinusoid + white noise, which looks "fuzzy" in phase space but the orbits always quickly return to the mean after deviation.&#160;<a class="footnote-backref" href="#fnref:control" rev="footnote" title="Jump back to footnote 5 in the text">&#8617;</a></p>
</li>
<li id="fn:benettin">
<p>Benettin, Giancarlo, et al. "Lyapunov characteristic exponents for smooth dynamical systems and for Hamiltonian systems; a method for computing all of them. Part 1: Theory." Meccanica 15.1 (1980): 9-20.&#160;<a class="footnote-backref" href="#fnref:benettin" rev="footnote" title="Jump back to footnote 6 in the text">&#8617;</a></p>
</li>
<li id="fn:rosenstein">
<p>Rosenstein, Michael T., James J. Collins, and Carlo J. De Luca. "A practical method for calculating largest Lyapunov exponents from small data sets." Physica D: Nonlinear Phenomena 65.1 (1993): 117-134.&#160;<a class="footnote-backref" href="#fnref:rosenstein" rev="footnote" title="Jump back to footnote 7 in the text">&#8617;</a></p>
</li>
<li id="fn:computed">
<p>Computed from the differential equations, as opposed to <em>measured</em> data from the LDV.&#160;<a class="footnote-backref" href="#fnref:computed" rev="footnote" title="Jump back to footnote 8 in the text">&#8617;</a></p>
</li>
<li id="fn:error">
<p>The Rosenstein, et. al. paper has several tables documenting how their method behaves for various underlying attractors, embedding dimensions, number of data points, lag value, and so on.&#160;<a class="footnote-backref" href="#fnref:error" rev="footnote" title="Jump back to footnote 9 in the text">&#8617;</a></p>
</li>
</ol>
</div>
	<hr/>
	<h6>Written by <a href="http://blog.iank.org/author/ian-kilgore.html">Ian Kilgore</a> in <a href="http://blog.iank.org/category/math.html">math</a> on Sun 26 July 2015. Tags: <a href="http://blog.iank.org/tag/chaos.html">chaos</a>, <a href="http://blog.iank.org/tag/geometry.html">geometry</a>, <a href="http://blog.iank.org/tag/research.html">research</a>, <a href="http://blog.iank.org/tag/experimental-data.html">experimental data</a>, </h6>
</article>

<hr/>
						</div>
						<!-- End Main Content -->
						<!-- Sidebar -->
						<aside class="medium-3 hide-for-small-only columns">
							<div class="panel">
								<h5>Places</h5>
								<ul class="side-nav">
									<li><a href="http://blog.iank.org/">Blog</a></li>
									<li><a href="http://blog.iank.org/pages/contact.html">Contact</a></li>
									<li><a href="http://iank.org/">Home</a></li>
									<li><a href="http://iank.org/projects.html">Projects</a></li>
								</ul>
							</div>

							<div class="panel">
								<h5>Tags</h5>
								<ul class="tag-cloud">
								</ul>
							</div>


<!--							<div class="panel">
								<h5>Links</h5>
								<ul class="side-nav">
								</ul> 
							</div> -->
						</aside>
						<!-- End Sidebar -->
					</div>

					<!-- Footer -->
					<footer class="row">
						<div class="medium-9 small-12">
							<hr/>
							<p class="text-center">Powered by <a href="http://getpelican.com">Pelican</a> and <a href="http://foundation.zurb.com/">Zurb Foundation</a>. Theme by <a href="http://hamaluik.com">Kenton Hamaluik</a>.</p>
						</div>
					</footer>
					<!-- End Footer -->
				</section>
				<a class="exit-off-canvas"></a>
			</div><!--off-canvas inner-->
		</div><!--off-canvas wrap-->

		<script src="http://blog.iank.org/theme/js/jquery.js"></script>
		<script src="http://blog.iank.org/theme/js/foundation.min.js"></script>
		<script>
			$(document).foundation();
		</script>
	</body>
</html>